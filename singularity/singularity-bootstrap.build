#!/usr/bin/env bash

ARCH=$1
VERSION=$2

export GOPATH=/usr/local/gopath
export PATH="/usr/local/go/bin:${PATH}:${GOPATH}/bin"

curl -fsSL https://github.com/hpcng/singularity/releases/download/v${VERSION}/singularity-${VERSION}.tar.gz | tar -C /usr/local -xz
cd /usr/local/singularity

./mconfig --prefix=/opt/singularity
make -C ./builddir
make -C ./builddir install

cd /opt
tar -cJf /root/singularity-${VERSION}-${ARCH}.tar.xz singularity
