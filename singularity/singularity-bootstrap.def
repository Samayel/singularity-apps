Bootstrap: docker
From: golang:1.16

%environment
    export LC_ALL=C

%post
    export DEBIAN_FRONTEND=noninteractive
    apt-get -yq update
    apt-get -yq install build-essential uuid-dev libgpgme-dev squashfs-tools libseccomp-dev wget curl pkg-config git cryptsetup-bin

%runscript
    VERSION=$1
    ARCH=$2

    curl -fsSL https://github.com/hpcng/singularity/releases/download/v${VERSION}/singularity-${VERSION}.tar.gz | tar -C /usr/local -xz
    cd /usr/local/singularity

    ./mconfig --prefix=/opt/singularity
    make -C ./builddir
    make -C ./builddir install

    cd /opt
    tar -cJf /root/singularity-${VERSION}-${ARCH}.tar.xz singularity
